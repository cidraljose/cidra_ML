<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">
            <i class="bi bi-bar-chart-line-fill"></i>
            Model <strong>{{ model.name }}</strong>
        </h1>
    </div>
    <hr>

    <div class="col-12">
        <h5>Model Details</h5>
        <ul class="list-group mb-4">
            <li class="list-group-item"><strong>Description:</strong> {{ model.description|default:"N/A" }}</li>
            <li class="list-group-item"><strong>Status:</strong> {{ model.get_status_display }}</li>
            <li class="list-group-item"><strong>Target Variable:</strong> {{ model.target }}</li>
            <li class="list-group-item"><strong>Training Dataset:</strong> {{ model.related_dataset.name|default:"N/A" }}</li>
            <li class="list-group-item"><strong>Training Time:</strong> {{ model.formatted_training_duration|default:"N/A" }}</li>
            <li class="list-group-item"><strong>Created On:</strong> {{ model.date|date:"Y-m-d H:i" }}</li>
        </ul>

        {% if model.features %}
        <h5 class="mt-4">Features Used for Training ({{ model.features|length }})</h5>
        <div class="list-group mb-4" style="max-height: 200px; overflow-y: auto;">
            {% for feature in model.features %}
                <div class="list-group-item py-1">{{ feature }}</div>
            {% endfor %}
        </div>
        {% endif %}

        {% if model.evaluation_plots.feature_importance %}
        <h5 class="mt-4"><i class="bi bi-diagram-3"></i> Feature Importance</h5>
        <p class="text-muted small">This table shows the relative importance of each feature in the model's predictions. Higher values indicate that the feature has a greater impact on the outcome.</p>
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
            <table class="table table-sm table-striped">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Importance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for feature, importance in model.evaluation_plots.feature_importance.importance.items %}
                    <tr>
                        <td>{{ feature }}</td>
                        <td>{{ importance|floatformat:4 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    <div class="row mt-4">
        <div class="col-12" id="leaderboard-section">
            <h5 class="mt-4"><i class="bi bi-trophy"></i> Model Leaderboard</h5>
            <p class="text-muted small">The leaderboard ranks the different models trained by AutoGluon based on their performance score on a test dataset. The best-performing models are listed at the top.</p>
            {% if test_results %}
            <div class="row align-items-center">
                <div class="col-md-6">
                    <label for="test-result-selector" class="form-label">Select a test run to view its leaderboard:</label>
                    <select id="test-result-selector" class="form-select">
                        <option value="">-- Select a test --</option>
                        {% for result in test_results %}
                        <option value="{{ result.id }}">Test on {{ result.dataset.name }} ({{ result.test_date|date:"Y-m-d H:i" }})</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            {% else %}
            <p class="text-muted">No test results found for this model. Please run an evaluation on the 'Testing' page to see the leaderboard.</p>
            {% endif %}
            <!-- Leaderboard will be loaded here by JavaScript -->
            <div id="leaderboard-container" class="mt-3"></div>
        </div>
    </div>
</div>
