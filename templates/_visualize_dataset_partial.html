<div class="card-header d-none">
    <!-- This header is hidden but used by JS to populate the modal title and refresh button -->
    <h3 class="mb-0">Dataset: {{ dataset.name }}</h3>
    <div>
        <button 
            type="button" 
            class="btn btn-sm btn-outline-secondary me-2 refresh-plots-btn" 
            data-url="{% url 'visualize_dataset_view' dataset.pk %}?refresh=true">
            Refresh
        </button>
    </div>
</div><div class="card-body">
    <div class="mt-3">
        <h4>Profile (first 5 rows)</h4>
        {{ head|safe }}
    </div>

    <div class="mt-4">
        <h4>Statistics</h4>
        {{ stats.description|safe }}
    </div>

    <div class="mt-4">
        <h4>Missing Values</h4>
        {% if stats.missing_values_plot %}
            <img src="data:image/png;base64,{{ stats.missing_values_plot }}" alt="Missing Values Plot" class="img-fluid border rounded">
        {% else %}
            <p class="text-muted">{{ stats.missing_values_message }}</p>
        {% endif %}
    </div>

    <hr class="my-4">
    <h3 class="mt-4">Plots</h3>

    {% if plots.correlation_heatmap %}
    <div class="mt-4 text-center">
        <h4>Correlation Heatmap</h4>
        <img src="data:image/png;base64,{{ plots.correlation_heatmap }}" alt="Correlation Heatmap" class="img-fluid border rounded">
    </div>
    {% endif %}

    {% if plots.pdf_plot %}
    <div class="mt-4 text-center">
        <h4>Kernel Density Estimate Plot (using MinMaxScaler)</h4>
        <img src="data:image/png;base64,{{ plots.pdf_plot }}" alt="PDF Plot" class="img-fluid border rounded">
    </div>
    {% endif %}

    <div class="row mt-4">
        {% for key, plot_b64 in plots.items %}
            {% if key != 'correlation_heatmap' and key != 'pdf_plot' %}
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h4 class="card-title text-capitalize">Histogram of {{ key|slice:"6:" }}</h4>
                            <img src="data:image/png;base64,{{ plot_b64 }}" alt="{{ key }} plot" class="img-fluid">
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>

</div>